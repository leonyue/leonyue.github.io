<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="baidu-site-verification" content="w9Akh6dPe4" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<!--[if lte IE 8]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]-->

<title>iOS单元测试 | 岳得建的技术博客</title>
<meta name="author" content="岳得建">




<link rel="shortcut icon" href="" />

<link rel="stylesheet" type="text/css" href="/assets/css/style.css">

<link href="/pages/rss.xml" rel="alternate" title="岳得建的技术博客" type="application/atom+xml">



  </head>
  <body>
        <aside id="sidebar">
  <nav id="tags">
    <a href="/index.html" id="avatar" style="background-image:url(https://avatars1.githubusercontent.com/u/14903329?v=3&s=460)"></a>

    <ul id="tags__ul">
      <li id="pl__all" class="tags__li tags-btn active">所有文章</li>
       
        <li id="技术" class="tags__li tags-btn">技术</li>
       
        <li id="iOS" class="tags__li tags-btn">iOS</li>
       
        <li id="专题" class="tags__li tags-btn">专题</li>
       
        <li id="web前端" class="tags__li tags-btn">web前端</li>
       
        <li id="C语言" class="tags__li tags-btn">C语言</li>
      
    </ul>

    <div id="tags__bottom">
      <a href="http://github.com/leonyue" id="icon-github" class="tags-btn fontello" target="_blank"></a>
      <a href="/pages/rss.xml" id="icon-feed" class="tags-btn fontello" target="_blank"></a>
      <a href="mailto:4940748@qq.com" id="icon-email" class="tags-btn fontello"></a>
    </div>
  </nav> <!-- end #tags -->

  <div id="posts-list">
    <form action="" id="search-form">
      <a href="/index.html" id="mobile-avatar" style="background-image:url(https://avatars1.githubusercontent.com/u/14903329?v=3&s=460)"></a>
      <!-- NOTE: input field is disabled by default -->
      <input id="search-input" type="text" placeholder="Search..." >
    </form>

    <nav id="pl__container">
    
      <a class="C语言 pl__all" href="/2016/05/12/fushu-buma-calculation.html"><span class="pl__circle"></span><span class="pl__title">负数补码运算</span><span class="pl__date">May 2016</span></a>
    
      <a class="C语言 pl__all" href="/2016/05/12/Pragma-pack.html"><span class="pl__circle"></span><span class="pl__title">pragma pack(非常有用的字节对齐用法说明)</span><span class="pl__date">May 2016</span></a>
    
      <a class="C语言 pl__all" href="/2016/05/11/IJKPlayer_study.html"><span class="pl__circle"></span><span class="pl__title">IJKPlayer学习笔记</span><span class="pl__date">May 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/04/12/pod-multi-project-manager.html"><span class="pl__circle"></span><span class="pl__title">使用Pods和自定义静态库实现多工程联编</span><span class="pl__date">Apr 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/04/03/iOS-JavaScriptCore.html"><span class="pl__circle"></span><span class="pl__title">iOS JavaScriptCore使用</span><span class="pl__date">Apr 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/04/02/iOS-3DTouch-3.html"><span class="pl__circle"></span><span class="pl__title">iOS 3D touch开发(三) Force Properties-按压力度</span><span class="pl__date">Apr 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/04/01/iOS-3DTouch-2.html"><span class="pl__circle"></span><span class="pl__title">iOS 3D touch开发(二) peek and pop - 预览和弹出</span><span class="pl__date">Apr 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/03/21/iOS-3DTouch-1.html"><span class="pl__circle"></span><span class="pl__title">iOS 3D touch开发(一) Home Screen Quick Actions</span><span class="pl__date">Mar 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/03/10/iOS-unit-test.html"><span class="pl__circle"></span><span class="pl__title">iOS单元测试</span><span class="pl__date">Mar 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/02/29/iOS-objc-styleguide.html"><span class="pl__circle"></span><span class="pl__title">iOS objc编程规范</span><span class="pl__date">Feb 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/02/13/ios-networking-5.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（五）网络请求中的cookie</span><span class="pl__date">Feb 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/02/09/ios-networking-4.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（四） http异步文件上传和下载以及进度指示</span><span class="pl__date">Feb 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/02/04/ios-networking-3.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（三） http异步请求和https认证</span><span class="pl__date">Feb 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/02/03/ios-networking-2.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（二） http异步队列请求</span><span class="pl__date">Feb 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/02/03/ios-networking-1.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（一） http同步请求</span><span class="pl__date">Feb 2016</span></a>
    
      <a class="技术 pl__all" href="/2016/02/02/react-native-demo.html"><span class="pl__circle"></span><span class="pl__title">react-native（二） 自己写的react-native学习demo和整理的tips</span><span class="pl__date">Feb 2016</span></a>
    
      <a class="技术 pl__all" href="/2016/01/11/react-native-helloworld.html"><span class="pl__circle"></span><span class="pl__title">react-native（一） hello world</span><span class="pl__date">Jan 2016</span></a>
    
      <a class="iOS pl__all" href="/2016/01/06/iOS-app-versions.html"><span class="pl__circle"></span><span class="pl__title">api如何设计才能支撑多个不同版本的app共存</span><span class="pl__date">Jan 2016</span></a>
    
      <a class="web前端 pl__all" href="/2015/11/26/rem-em-px.html"><span class="pl__circle"></span><span class="pl__title">css3属性rem的使用</span><span class="pl__date">Nov 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/11/24/iOS-affine-transfermation-animation.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（七）仿射变换-CGAffineTransform</span><span class="pl__date">Nov 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/11/22/iOS-library-spring.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（六）swift动画库spring使用和代码拆解</span><span class="pl__date">Nov 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/11/16/iOS-Implicit-Animation.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（五）layer隐式动画</span><span class="pl__date">Nov 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/11/06/iOS-controller-transitioning.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（四）controller间的自定义过渡效果</span><span class="pl__date">Nov 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/11/01/iOS-MotionEffects.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（三）MotionEffects</span><span class="pl__date">Nov 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/10/30/iOS-UIKit-Dynamics.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（二）UIKit力学行为</span><span class="pl__date">Oct 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/10/30/iOS-Animation-UIViewAndCoreAnimation.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（一）UIView动画和CoreAnimation</span><span class="pl__date">Oct 2015</span></a>
    
      <a class="专题 pl__all" href="/2015/10/29/iOS-animation-0.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效专题（零）- 大纲和计划</span><span class="pl__date">Oct 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/10/17/ios-webView.html"><span class="pl__circle"></span><span class="pl__title">UIWebView和WKWebView的使用及js交互</span><span class="pl__date">Oct 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/10/06/ios-swift-quick.html"><span class="pl__circle"></span><span class="pl__title">swift5分钟语法速记</span><span class="pl__date">Oct 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/09/20/ios-macro.html"><span class="pl__circle"></span><span class="pl__title">ios宏的使用和技巧</span><span class="pl__date">Sep 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/09/11/ios-BLE-4.html"><span class="pl__circle"></span><span class="pl__title">ios蓝牙开发（四）BabyBluetooth蓝牙库介绍</span><span class="pl__date">Sep 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/09/07/ios-BLE-3.html"><span class="pl__circle"></span><span class="pl__title">ios蓝牙开发（三）app作为外设被连接的实现</span><span class="pl__date">Sep 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/09/02/ios-draw-Graffiti-2.html"><span class="pl__circle"></span><span class="pl__title">ios绘图demo,做一个涂鸦板(下)</span><span class="pl__date">Sep 2015</span></a>
    
      <a class="技术 pl__all" href="/2015/08/22/github-ImagesUploadWebSite.html"><span class="pl__circle"></span><span class="pl__title">自己markdown博客的图床程序</span><span class="pl__date">Aug 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/08/19/ios-ThreadAndAsynchronization.html"><span class="pl__circle"></span><span class="pl__title">ios的线程和同步异步操作</span><span class="pl__date">Aug 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/08/14/ios-BLE-2.html"><span class="pl__circle"></span><span class="pl__title">ios蓝牙开发（二）ios连接外设的代码实现</span><span class="pl__date">Aug 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/07/26/ios-draw-Graffiti.html"><span class="pl__circle"></span><span class="pl__title">ios绘图demo,做一个涂鸦板(上)</span><span class="pl__date">Jul 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/07/25/ios-draw-base.html"><span class="pl__circle"></span><span class="pl__title">ios绘图基础</span><span class="pl__date">Jul 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/07/17/ios-BLE-1.html"><span class="pl__circle"></span><span class="pl__title">iOS蓝牙开发（一）蓝牙相关基础知识</span><span class="pl__date">Jul 2015</span></a>
    
      <a class="专题 pl__all" href="/2015/07/17/ios-BLE-0.html"><span class="pl__circle"></span><span class="pl__title">iOS蓝牙的开发专题</span><span class="pl__date">Jul 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/06/14/ios-library-masonry.html"><span class="pl__circle"></span><span class="pl__title">Masonry的使用</span><span class="pl__date">Jun 2015</span></a>
    
      <a class="专题 pl__all" href="/2015/06/14/ios-library-0.html"><span class="pl__circle"></span><span class="pl__title">iOS中那些好用的第三方库</span><span class="pl__date">Jun 2015</span></a>
    
      <a class="iOS pl__all" href="/2015/05/29/ios-develop-tool.html"><span class="pl__circle"></span><span class="pl__title">提高iOS开发效率的工具</span><span class="pl__date">May 2015</span></a>
    
      <a class=" pl__all" href="/2015/05/28/spring-0.html"><span class="pl__circle"></span><span class="pl__title">Spring 0</span><span class="pl__date">May 2015</span></a>
    
      <a class="技术 pl__all" href="/2014/02/12/how-to-deploy-a-blog-on-github-by-jekyll.html"><span class="pl__circle"></span><span class="pl__title">在Github上搭建Jekyll博客和创建主题</span><span class="pl__date">Feb 2014</span></a>
    
    </nav>
  </div> <!-- end #posts-list -->
</aside> <!-- end #sidebar -->
    <div id="post">
      <div id="pjax">
        <article id="post__content">
    <h1 id="post__title" data-identifier="20160310">iOS单元测试</h1>
    <blockquote>
  <p>Xcode集成了对测试的支持,其中单元测试使用的是XCTest框架 <code class="highlighter-rouge">&lt;XCTest/XCTest.h&gt;</code> ，良好的单元测试可以提高产品的稳定性，快速定位bug，节省开发时间。确实能节省时间，<a href="https://github.com/coolnameismy/BabyBluetooth">babybluetooth</a>的开发中，每次有修改后总是要进行手动测试费时费力效果还不好,在折腾过一阵子之后，我决定开始写单元测试，为自己节省时间。</p>
</blockquote>

<p>本文主要介XCTest单元测试的基础，测试方法，断言，期望，测试命令等等。</p>

<h2 id="quick-start">quick start</h2>

<p>在xcode新建项目中，默认都会给你建一个单元测试的target，如果你的项目没有，可以在导航中选择 File-&gt;New-&gt;Target-&gt;选择ios-test-&gt;选择iOS Unit Testing Bundle 新建一个测试target。</p>

<p>建好后默认会建一个测试类，代码如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//
//  BasicTests.m
//  BabyBluetoothAppDemo
//
//  Created by ZTELiuyw on 16/3/9.
//  Copyright © 2016年 刘彦玮. All rights reserved.
//
</span>
<span class="cp">#import &lt;XCTest/XCTest.h&gt;
</span>
<span class="k">@interface</span> <span class="nc">BasicTests</span> <span class="p">:</span> <span class="nc">XCTestCase</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">BasicTests</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">setUp</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">setUp</span><span class="p">];</span>
    <span class="c1">// Put setup code here. This method is called before the invocation of each test method in the class.
</span><span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">tearDown</span> <span class="p">{</span>
    <span class="c1">// Put teardown code here. This method is called after the invocation of each test method in the class.
</span>    <span class="p">[</span><span class="n">super</span> <span class="nf">tearDown</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">testExample</span> <span class="p">{</span>
    <span class="c1">// This is an example of a functional test case.
</span>    <span class="c1">// Use XCTAssert and related functions to verify your tests produce the correct results.
</span><span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">testPerformanceExample</span> <span class="p">{</span>
    <span class="c1">// This is an example of a performance test case.
</span>    <span class="p">[</span><span class="n">self</span> <span class="nf">measureBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="c1">// Put the code you want to measure the time of here.
</span>    <span class="p">}];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre>
</div>

<p>其中有几点需要大家注意：</p>

<ul>
  <li>1：该类中以test开头的方法且void返回类型的方法都会变成单元测试用例</li>
  <li>2：单元测试类继承自XCTestCase，他有一些重要的方法，其中最重要的有3个，<code class="highlighter-rouge"> setUp ,tearDown,measureBlock</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//每次测试前调用，可以在测试之前创建在test case方法中需要用到的一些对象等
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">setUp</span> <span class="p">;</span>
<span class="c1">//每次测试结束时调用tearDown方法
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">tearDown</span> <span class="p">;</span>

<span class="c1">//性能测试方法，通过测试block中方法执行的时间，比对设定的标准值和偏差觉得是否可以通过测试
</span><span class="n">measureBlock</span>
</code></pre>
</div>

<h2 id="section">断言</h2>
<blockquote>
  <p>大部分的测试方法使用断言决定的测试结果。所有断言都有一个类似的形式：比较，表达式为真假，强行失败等。</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//通用断言
</span><span class="n">XCTAssert</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">format</span><span class="p">...)</span>
<span class="c1">//常用断言：
</span><span class="n">XCTAssertTrue</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">format</span><span class="p">...)</span>
<span class="n">XCTAssertFalse</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">format</span><span class="p">...)</span>
<span class="n">XCTAssertEqual</span><span class="p">(</span><span class="n">expression1</span><span class="p">,</span> <span class="n">expression2</span><span class="p">,</span> <span class="n">format</span><span class="p">...)</span>
<span class="n">XCTAssertNotEqual</span><span class="p">(</span><span class="n">expression1</span><span class="p">,</span> <span class="n">expression2</span><span class="p">,</span> <span class="n">format</span><span class="p">...)</span>
<span class="n">XCTAssertEqualWithAccuracy</span><span class="p">(</span><span class="n">expression1</span><span class="p">,</span> <span class="n">expression2</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">format</span><span class="p">...)</span>
<span class="n">XCTAssertNotEqualWithAccuracy</span><span class="p">(</span><span class="n">expression1</span><span class="p">,</span> <span class="n">expression2</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">format</span><span class="p">...)</span>
<span class="n">XCTAssertNil</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">format</span><span class="p">...)</span>
<span class="n">XCTAssertNotNil</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">format</span><span class="p">...)</span>

<span class="n">XCTFail</span><span class="p">(</span><span class="n">format</span><span class="p">...)</span> <span class="c1">//直接Fail的断言
</span></code></pre>
</div>

<p>举个栗子</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">testExample</span> <span class="p">{</span>
    <span class="c1">//设置变量和设置预期值
</span>    <span class="n">NSUInteger</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span><span class="n">NSUInteger</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
    <span class="n">NSUInteger</span> <span class="n">expected</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
    <span class="c1">//执行方法得到实际值
</span>    <span class="n">NSUInteger</span> <span class="n">actual</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">add</span><span class="p">:</span><span class="n">a</span> <span class="nf">b</span><span class="p">:</span><span class="n">b</span><span class="p">];</span>
    <span class="c1">//断言判定实际值和预期是否符合
</span>    <span class="n">XCTAssertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span><span class="s">@"add方法错误！"</span><span class="p">);</span>
<span class="p">}</span>
<span class="o">-</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="n">add</span><span class="o">:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="n">a</span> <span class="n">b</span><span class="o">:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="n">b</span><span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>从这也能看出一个测试用例比较规范的写法，1：定义变量和预期，2：执行方法得到实际值，3：断言</p>

<h2 id="section-1">性能测试</h2>

<p>性能测试主要使用 <code class="highlighter-rouge">measureBlock</code> 方法 ，用于测试一组方法的执行时间，通过设置baseline（基准）和stddev（标准偏差）来判断方法是否能通过性能测试。</p>

<p>举个栗子：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">testPerformanceExample</span> <span class="p">{</span>
    <span class="c1">// This is an example of a performance test case.
</span>    <span class="p">[</span><span class="n">self</span> <span class="nf">measureBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
		  <span class="c1">//Put the code you want to measure the time of here.
</span>		  <span class="c1">//你的性能测试的代码放在这里
</span>    <span class="p">}];</span>
<span class="p">}</span>
</code></pre>
</div>

<p>直接执行方法，因为block中没有内容，所以方法的执行时间为0.0s,如果我们把baseline设成0.05，偏差10%,是可以通过的测试的。但是如果设置如果我们把baseline为1，偏差10%，那测试会失败，因为不满足条件。</p>

<p><img src="http://images.jumppo.com/uploads/320A0A3C-6264-4C75-8EC7-1E2EEB5B13D0.png" alt="" /></p>

<h2 id="section-2">期望</h2>
<blockquote>
  <p>期望实际上是异步测试，当测试异步方法时，因为结果并不是立刻获得，所以我们可以设置一个期望，期望是有时间限定的的，fulfill表示满足期望</p>
</blockquote>

<p>举个栗子</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">testAsynExample</span> <span class="p">{</span>
    <span class="n">XCTestExpectation</span> <span class="o">*</span><span class="n">exp</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">expectationWithDescription</span><span class="p">:</span><span class="s">@"这里可以是操作出错的原因描述。。。"</span><span class="p">];</span>
    <span class="n">NSOperationQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSOperationQueue</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">init</span><span class="p">];</span>
    <span class="p">[</span><span class="n">queue</span> <span class="nf">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="c1">//模拟这个异步操作需要2秒后才能获取结果，比如一个异步网络请求
</span>        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="err">;</span>
        <span class="c1">//模拟获取的异步操作后，获取结果，判断异步方法的结果是否正确
</span>        <span class="n">XCTAssertEqual</span><span class="p">(</span><span class="s">@"a"</span><span class="p">,</span> <span class="s">@"a"</span><span class="p">)</span><span class="err">;</span>
        <span class="c1">//如果断言没问题，就调用fulfill宣布测试满足
</span>        <span class="p">[</span><span class="n">exp</span> <span class="nf">fulfill</span><span class="p">]</span><span class="err">;</span>
    <span class="p">}];</span>

    <span class="c1">//设置延迟多少秒后，如果没有满足测试条件就报错
</span>    <span class="p">[</span><span class="n">self</span> <span class="nf">waitForExpectationsWithTimeout</span><span class="p">:</span><span class="mi">3</span> <span class="nf">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Timeout Error: %@"</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span><span class="err">;</span>
        <span class="p">}</span>
    <span class="p">}];</span>
<span class="p">}</span>
</code></pre>
</div>

<p>这个测试肯定是通过的，因为设置延迟为3秒，而异步操作2秒就除了一个正确的结果，并宣布了条件满足<code class="highlighter-rouge"> [exp fulfill]</code>，但是当我们把延迟改成1秒，这个测试用例就不会成功，错误原因是 <code class="highlighter-rouge">expectationWithDescription:@"这里可以是操作出错的原因描述。。。</code></p>

<p>异步测试除了使用 <code class="highlighter-rouge">expectationWithDescription</code>以外，还可以使用 <code class="highlighter-rouge">expectationForPredicate和expectationForNotification </code></p>

<p>下面这个例子使用<code class="highlighter-rouge">expectationForPredicate </code> 测试方法，代码来自于AFNetworking，用于测试<code class="highlighter-rouge">backgroundImageForState</code>方法</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">testThatBackgroundImageChanges</span> <span class="p">{</span>
    <span class="n">XCTAssertNil</span><span class="p">([</span><span class="n">self</span><span class="p">.</span><span class="n">button</span> <span class="nf">backgroundImageForState</span><span class="p">:</span><span class="n">UIControlStateNormal</span><span class="p">]);</span>
	<span class="n">NSPredicate</span> <span class="o">*</span><span class="n">predicate</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSPredicate</span> <span class="nf">predicateWithBlock</span><span class="p">:</span><span class="o">^</span><span class="n">BOOL</span><span class="p">(</span><span class="n">UIButton</span>  <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">button</span><span class="p">,</span> <span class="n">NSDictionary</span><span class="o">&lt;</span><span class="n">NSString</span> <span class="o">*</span><span class="p">,</span><span class="n">id</span><span class="o">&gt;</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">bindings</span><span class="p">)</span> <span class="p">{</span>
	        <span class="k">return</span> <span class="p">[</span><span class="n">button</span> <span class="nf">backgroundImageForState</span><span class="p">:</span><span class="n">UIControlStateNormal</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">nil</span><span class="err">;</span>
    <span class="p">}];</span>

    <span class="p">[</span><span class="n">self</span> <span class="nf">expectationForPredicate</span><span class="p">:</span><span class="n">predicate</span>
              <span class="nf">evaluatedWithObject</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">button</span>
                          <span class="nf">handler</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">waitForExpectationsWithTimeout</span><span class="p">:</span><span class="mi">20</span> <span class="nf">handler</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="p">}</span>
</code></pre>
</div>

<p>利用谓词计算，button是否正确的获得了backgroundImage，如果正确20秒内正确获得则通过测试，否则失败。</p>

<p><code class="highlighter-rouge"> expectationForNotification </code> 方法 ,该方法监听一个通知,如果在规定时间内正确收到通知则测试通过。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">testAsynExample1</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">expectationForNotification</span><span class="p">:(</span><span class="s">@"监听通知的名称xxx"</span><span class="p">)</span> <span class="nf">object</span><span class="p">:</span><span class="nb">nil</span> <span class="nf">handler</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
    <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="nf">defaultCenter</span><span class="p">]</span><span class="nf">postNotificationName</span><span class="p">:</span><span class="s">@"监听通知的名称xxx"</span> <span class="nf">object</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>

    <span class="c1">//设置延迟多少秒后，如果没有满足测试条件就报错
</span>    <span class="p">[</span><span class="n">self</span> <span class="nf">waitForExpectationsWithTimeout</span><span class="p">:</span><span class="mi">3</span> <span class="nf">handler</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="p">}</span>
</code></pre>
</div>

<p>这个例子也可以用<code class="highlighter-rouge">expectationWithDescription</code>实现,只是多些很多代码而已，但是这个可以帮助你更好的理解 <code class="highlighter-rouge">expectationForNotification</code> 方法和 <code class="highlighter-rouge">expectationWithDescription</code> 的区别。同理，<code class="highlighter-rouge">expectationForPredicate</code>方法也可以使用<code class="highlighter-rouge">expectationWithDescription</code>实现。</p>

<div class="highlighter-rouge"><pre class="highlight"><code> <span class="n">func</span> <span class="nf">testAsynExample1</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">expectation</span> <span class="o">=</span> <span class="n">expectationWithDescription</span><span class="p">(</span><span class="s">"监听通知的名称xxx"</span><span class="p">)</span>
    <span class="n">let</span> <span class="n">sub</span> <span class="o">=</span> <span class="n">NSNotificationCenter</span><span class="p">.</span><span class="n">defaultCenter</span><span class="p">().</span><span class="n">addObserverForName</span><span class="p">(</span><span class="s">"监听通知的名称xxx"</span><span class="p">,</span> <span class="n">object</span><span class="o">:</span> <span class="nb">nil</span><span class="p">,</span> <span class="n">queue</span><span class="o">:</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">not</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
        <span class="n">expectation</span><span class="p">.</span><span class="n">fulfill</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">NSNotificationCenter</span><span class="p">.</span><span class="n">defaultCenter</span><span class="p">().</span><span class="n">postNotificationName</span><span class="p">(</span><span class="s">"监听通知的名称xxx"</span><span class="p">,</span> <span class="n">object</span><span class="o">:</span> <span class="nb">nil</span><span class="p">)</span>
    <span class="n">waitForExpectationsWithTimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">handler</span><span class="o">:</span> <span class="nb">nil</span><span class="p">)</span>
    <span class="n">NSNotificationCenter</span><span class="p">.</span><span class="n">defaultCenter</span><span class="p">().</span><span class="n">removeObserver</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="section-3">命令行测试</h2>
<blockquote>
  <p>测试不仅可以在xcode中执行，也可以在命令行中执行，这个便于代码持续集成和构建，在git提交中也编译检查代码</p>
</blockquote>

<p>如果你有development-enabled设备插入，你可以按照名称或 id 调用他们。例如，如果你有一个名为”Development iPod touch”的 iPod 设备连接了测试的代码，可以使用下面的命令来测试代码
<code class="highlighter-rouge"> &gt; xcodebuild test -project MyAppProject.xcodeproj -scheme MyApp -destination 'platform=iOS,name=Development iPod touch </code></p>

<p>测试也可以在 iOS模拟器上运行。使用模拟器可以应对不同的外形因素和操作系统版本。例如
<code class="highlighter-rouge"> &gt; xcodebuild test -project MyAppProject.xcodeproj -scheme MyApp -destination 'platform=iOS Simulator,name=iPhone,0S=7.0' </code></p>

<p>-destination 参数可以被连接在一起，这样你只需使用一个命令，就可以跨目标进行指定集成共享方案。例如，下面的命令把之前的三个例子合并到一个命令中</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&gt; xcodebuild test -project MyAppProject.xcodeproj -scheme MyApp
-destination 'platform=OS X,arch=x86_64'
-destination 'platform=iOS,name=Development iPod touch'
-destination 'platform=iOS Simulator,name=iPhone,0S=7.0'
</code></pre>
</div>

<p>关于更多xcodebuild的使用可以查看man手册 <code class="highlighter-rouge">&gt; man xcodebuild  </code></p>

<h2 id="section-4">执行测试快捷键</h2>

<ul>
  <li>cmd + 5 切换到测试选项卡后会看到很多小箭头，点击可以单独或整体测试</li>
  <li>cmd + U 运行整个单元测试</li>
</ul>

<h2 id="section-5">注意点</h2>
<blockquote>
  <p>都是血与泪的教训</p>
</blockquote>

<ul>
  <li>使用pod的项目中，在XC测试框架中测试内容包括第三方包时，需要手动去设置Header Search Paths才能找到头文件 ，还需要设置test target的PODS_ROOT。</li>
  <li>xcode7要使用真机做跑测试时，证书必须配对，否则会报错<code class="highlighter-rouge">exc_breakpoint</code>错误</li>
  <li>XCTestExpectation的fulfill方法只能调用一次，系统不会帮你检查，如果你调用两次就会出错，而且你经常都找不到错在哪里。</li>
</ul>

<h2 id="section-6">参考阅读</h2>

<ul>
  <li><a href="http://www.cocoachina.com/cms/tags.php?/Xcode%E6%B5%8B%E8%AF%95/">cocoachina测试专题</a></li>
  <li><a href="http://www.jianshu.com/p/8bbec078cabe">iOS单元测试(作用及入门提升)</a></li>
  <li><a href="http://stackoverflow.com/questions/29802214/in-what-situation-would-one-use-expectationfornotification-in-swift-testing">In what situation would one use expectationForNotification in swift testing</a></li>
  <li>[XCTest 测试实战](http://www.objccn.io/issue-15-2/）</li>
  <li><a href="https://onevcat.com/2015/09/ui-testing/">WWDC15 Session笔记 - Xcode 7 UI 测试初窥</a></li>
</ul>

<h2 id="section-7">最后</h2>

<p>感谢收看，如果对大家有帮助，请<a href="https://github.com/coolnameismy">github上follow和star</a>，本文发布在<a href="http://liuyanwei.jumppo.com/">刘彦玮的技术博客</a>，转载请注明出处</p>

    <div class="declare">
        <div>

        </div>
    </div>
</article>
<!-- end #post__content -->

<div id="post__share">
  <a id="icon-twitter" class="fontello" href="https://twitter.com/intent/tweet?url=https://leonyue.github.io/2016/03/10/iOS-unit-test.html&text=iOS单元测试" target="_blank"></a>
  <a id="icon-cc" class="fontello" href="http://github.com/leonyue" target="_blank"></a>
  <a id="icon-weibo" class="fontello" href="http://v.t.sina.com.cn/share/share.php?url=https://leonyue.github.io/2016/03/10/iOS-unit-test.html&title=iOS单元测试" target="_blank"></a>
    <div class="share-info">分享一下~</div>
</div>
<!-- end #post__share -->
<div id="disqus_thread" name="leonyue">
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink" target="_blank">Loading Disqus comments...</a>
</div>


            <!---->
    <!--<p id="copyright">Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>-->
    <!--&nbsp;&nbsp;|&nbsp;&nbsp;Theme <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll</a>-->
    <!--&nbsp;&nbsp;|&nbsp;&nbsp;Hosted on <a href="https://pages.github.com" target="_blank">Github</a></p>-->
      </div> <!-- end #pjax -->

      <div id="post__toc-trigger">
        <div id="post__toc">
          <span id="post__toc-title">Table of Contents</span>
          <ul id="post__toc-ul"></ul>
        </div>
      </div>
    </div> <!-- end #post -->

    <button id="js-fullscreen"><span id="icon-arrow" class="fontello"></span></button>

<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.pjax.js"></script>
<script src="/assets/js/nprogress.js"></script>
<script src="/assets/js/searchbox.js"></script>
<script src="/assets/js/script.js"></script>


    <script>
    //百度站点统计,排除localhost
    if(window.location.host.indexOf("localhost") ==-1){

        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    }
</script>
   </body>
 </html>